{
  "hash": "38d286e25d7bd1b87e69f19a705f80d6",
  "result": {
    "markdown": "---\ntitle: \"Explore Cognitive Structure for Executive Function\"\nauthor: \"Liang Zhang\"\ndate: \"2022-05-10\"\ndraft: true\nformat:\n  html:\n    code-fold: true\n    toc: true\n    toc-location: left\ncategories: [structure, ef]\nexecute:\n  warning: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(corrr)\nlibrary(BayesFM)\n```\n:::\n\n::: {.cell hash='index_cache/html/load-data_0a8970ccb32684baaf968d61d90a0527'}\n\n```{.r .cell-code}\ntargets::tar_load(users, store = here::here(\"preproc/_targets\"))\nind_filt <- readxl::read_excel(here::here(\"config/indices_filtering.xlsx\"))\ndim_order <- c(\"attention\", \"multitask\", \"switching\", \"inhibition\",\n               \"reasoning\", \"complex span\", \"working memory\", \"short term memory\",\n               \"long term memory\", \"probability learning\",\n               \"speeded IP\", \"strategic IP\",\n               \"perception\", \"math\", \"language\")\nindices_clean <- targets::tar_read(indices_final, store = here::here(\"preproc/_targets\")) |>\n  full_join(ind_filt, by = c(\"game_name\", \"index_name\")) |>\n  filter(\n    !is.na(check_result) & check_result != \"target-stash\",\n    grade != \"20220303级\",\n    !game_name %in% c(\"文字推理\", \"数字推理\")\n  ) |>\n  arrange(factor(dimension, dim_order)) |>\n  mutate(test = if_else(reversed, -test, test)) |>\n  group_by(game_name, index_name) |>\n  mutate(test = if_else(test %in% boxplot.stats(test)$out, NA_real_, test)) |>\n  ungroup()\nindices_ef <- indices_clean |>\n  filter(\n    dimension %in% c(\"complex span\", \"working memory\", \"switching\", \"inhibition\")\n  ) |>\n  add_count(user_id, game_name) |>\n  mutate(\n    game_index = if_else(\n      n == 1,\n      game_name,\n      str_c(game_name, index_name, sep = \"-\")\n    )\n  ) |>\n  pivot_wider(\n    id_cols = user_id,\n    names_from = game_index,\n    values_from = test\n  ) |>\n  select(-user_id)\n```\n:::\n\n\nThe include tasks:\n\n* 候鸟迁徙PRO-switch_cost_ies\n* 卡片分类PRO\n* 察颜观色PRO-switch_cost_ies\n* 候鸟迁徙PRO-cong_eff_ies\n* 变色魔块PRO\n* 太空飞船PRO\n* 多彩文字PRO\n* 察颜观色PRO-cong_eff_ies\n* 变戏法\n* 蝴蝶照相机\n* 打靶场\n* 幸运小球\n* 数字卡片\n* 格子卡片\n* 美术卡片\n* 文字卡片\n* 密码箱\n* 魔术师终极\n\n# Correlation Matrix\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrelate(indices_ef, quiet = TRUE) |>\n  rearrange(method = \"HC\") |>\n  stretch() |>\n  mutate(across(c(x, y), as_factor)) |>\n  ggplot(aes(x, y)) +\n  geom_tile(aes(fill = r)) +\n  scico::scale_fill_scico(palette = \"bam\", midpoint = 0, direction = -1) +\n  coord_fixed() +\n  theme_minimal(base_size = 18) +\n  labs(x = \"\", y = \"\", fill = \"Pearson's\", color = \"\") +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=960}\n:::\n:::\n\n\n# Multidimensional Scaling\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmds <- indices_ef |>\n  cor(use = \"pairwise\") |>\n  smacof::sim2diss(to.dist = TRUE) |>\n  smacof::mds(ndim = 2, type = \"mspline\")\n# plot(mds, plot.type = \"Shepard\", main = \"Shepard Diagram (Ratio Transformation)\")\n# par(family = \"SimHei\")\nplot(mds)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n# Exploratory Factor Analysis\n\n## Traditional\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnfactors_test <- psych::nfactors(indices_ef)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n* Correlated latent factors\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- psych::fa(indices_ef, 4)\npsych::fa.diagram(fit)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n* Bifactor model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_bifac <- psych::omega(indices_ef, 4, plot = FALSE)\npsych::omega.diagram(fit_bifac)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## Bayesian Factor Analysis\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-8_fa613053d84b269559d58720981aa1ae'}\n\n```{.r .cell-code}\n# mcmc <- indices_ef |>\n#   mutate(across(.fns = ~ scale(.)[, 1])) |>\n#   befa(verbose = FALSE) |>\n#   post.column.switch() |>\n#   post.sign.switch()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# hppm <- summary(mcmc, what = \"hppm\")\n# hppm |>\n#   pluck(\"alpha\", \"m1\") |>\n#   as_tibble(rownames = \"alpha_term\") |>\n#   separate(alpha_term, c(NA, \"game_index\"), sep = \":\") |>\n#   mutate(game_index = reorder(game_index, dedic)) |>\n#   ggplot(aes(game_index, dedic)) +\n#   geom_tile(aes(fill = mean)) +\n#   geom_text(aes(label = round(mean, 2)), color = \"white\") +\n#   scico::scale_fill_scico(palette = \"bam\", midpoint = 0, direction = -1) +\n#   coord_fixed() +\n#   theme_minimal(base_size = 18) +\n#   labs(x = \"Term\", y = \"Factor\",\n#        title = str_c(\"Posterior Probability: \", round(hppm$hppm$prob, 2),\n#                      \", with \", hppm$hppm$nfac, \" factors\")) +\n#   theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n:::\n\n\n# Confirmatory Factor Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# fitted1 <- lavaan::cfa(\n#   'Updating =~ `美术卡片` + `数字卡片` + `格子卡片` + `文字卡片`\n#   # AscMem =~ `人工语言-中级` + `欢乐餐厅` + 图片记忆\n#   VerbalSTM =~ `幸运小球` + `密码箱` + `顺背数PRO`\n#   SpatialSTM =~ `宇宙黑洞` + `打靶场` + `蝴蝶照相机` + `位置记忆PRO`',\n#   indices_memory, std.lv = TRUE, std.ov = TRUE\n# )\n# semPlot::semPaths(\n#   fitted1, what = \"std\", edge.color = \"black\", rotation = 2,\n#   sizeMan = 6, sizeLat = 8, edge.label.cex = 0.6,\n#   nCharEdges = 5, esize = 1, trans = 1, nCharNodes = 0\n# )\n# lavaan::summary(fitted1, fit.measures = TRUE, estimates = FALSE)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}